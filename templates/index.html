<!DOCTYPE html>
<html>
<meta http-equiv="pragma" content="no-cache" />
<head>
  <title>Alt Text Check</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    let prolificPID;
    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        prolificPID = urlParams.get('PROLIFIC_PID');
    };

    async function submitResponse(event) {
        event.preventDefault();

        const selectedOption = document.querySelector('input[name="options"]:checked');
        if (!selectedOption) {
            alert("Please select an option before proceeding.");
            return;
        }

        const responses = {
            prolificPID: prolificPID,
            img_url: '{{ image_url | escape }}',
            article_name: '{{ article_name | escape }}',
            alttext_type: selectedOption.value,
            question_count: '{{ question_count }}',
        };

        const response = await fetch('/nextImg', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(responses),
        });

        if (response.redirected) {
          window.location.href = response.url;
        }

    }

    $(document).ready(function() {
      const options = JSON.parse('{{ options | tojson | safe }}');
      console.log(options);
      const isAttentionCheck = '{{ is_attention_check | tojson | safe }}';
      const optionsContainer = $('#optionsContainer');

      options.forEach((option, index) => {
          const optionId = `option${index + 1}`;
          const value = (isAttentionCheck === "true") ? (option.is_correct ? 'correct' : 'incorrect') : option.type;

          const input = $('<input>')
              .attr('type', 'radio')
              .attr('name', 'options')
              .attr('id', optionId)
              .attr('value', value);

          const label = $('<label>')
              .attr('for', optionId)
              .text(option.text);

          optionsContainer.append(input, label, $('<br>'));
      });

        $('#submit-button').on('click', submitResponse);
    });
  </script>
</head>

<body>
  <div class="container">
    <div class="image-column">
      <img src="{{ image_url }}" alt="Research image">
    </div>
    <div class="content-column">
      <h2>{{ article_name | safe }}</h2>
      <p>{{ context | safe }}</p>
      <div class="form-section">
        <h2>Select the best alt-text for this image</h2>
        <form id="nextImg">
          <div id="optionsContainer"></div>
          <button type="submit" id="submit-button">Next</button>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
