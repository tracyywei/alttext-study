<!DOCTYPE html>
<html>
<meta http-equiv="pragma" content="no-cache" />
<head>
  <title>Alt Text Check</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    let prolificPID;
    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        prolificPID = urlParams.get('PROLIFIC_PID');
    };

    const img_url = '{{ image_url | escape }}';
    const article_name = '{{ article_name | escape }}';
    
    async function submitResponse(responses) {
        const selected = document.querySelector('input[name="options"]:checked');
        responses.prolificPID = prolificPID;
        responses.img_url = img_url;
        responses.article_name = article_name;
        responses.alttext_type = selected.value;
        await fetch('/nextImg', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(responses),
        });
        window.location.href = `/eval?PROLIFIC_PID=${encodeURIComponent(prolificPID)}`;
    };
      
    $(document).ready(function(){

      // randomizing alt-text options order
      const options = [
          { id: "option1", value: "no_crt_no_cnxt", label: "{{ no_crt_no_cnxt }}" },
          { id: "option2", value: "no_crt_yes_cnxt", label: "{{ no_crt_yes_cnxt }}" },
          { id: "option3", value: "yes_crt_no_cnxt", label: "{{ yes_crt_no_cnxt }}" },
          { id: "option4", value: "yes_crt_yes_cnxt", label: "{{ yes_crt_yes_cnxt }}" },
      ];
      function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
          }
      }
      shuffleArray(options);
      const optionsContainer = document.getElementById('optionsContainer');
      options.forEach(option => {
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = 'options';
          input.id = option.id;
          input.value = option.value;

          const label = document.createElement('label');
          label.htmlFor = option.id;
          label.innerHTML = option.label;

          optionsContainer.appendChild(input);
          optionsContainer.appendChild(label);
          optionsContainer.appendChild(document.createElement('br'));
      });

      document.getElementById('submit-button').addEventListener('click', submitResponse);
    });
  </script>
</head>


<body>
  <div class="container">
    <div class="image-column">
      <img src="{{ image_url }}" alt="Research image">
    </div>
    <div class="content-column">
      <h2>{{ article_name | safe }}</h2>
      <p>{{ context | safe }}</p>
      <div class="form-section">
        <h2>Select the best alt-text for this image</h2>
        <form id="nextImg">
          <div id="optionsContainer"></div>
          <button type="submit" id="submit-button">Next</button>
        </form>
      </div>
    </div>
  </div>
</body>

</html>